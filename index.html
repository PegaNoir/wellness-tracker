<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#3B82F6">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Wellness Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
  <div id="root"></div>
  
  <script>
    // No Babel - Pure JavaScript version
    const { useState, useEffect, createElement: h } = React;
    
    function WellnessTracker() {
      const [entries, setEntries] = useState([]);
      const [currentEntry, setCurrentEntry] = useState({});
      const [view, setView] = useState('today');
      const [googleSheetUrl, setGoogleSheetUrl] = useState('');
      const [isConnected, setIsConnected] = useState(false);
      const [showSettings, setShowSettings] = useState(false);

      const attributes = [
        { id: 'sleep_own_bed', name: 'Slept in own bed', type: 'boolean' },
        { id: 'sleep_quality', name: 'Sleep quality (1-10)', type: 'number' },
        { id: 'alcohol', name: 'Consumed alcohol', type: 'boolean' },
        { id: 'exercise', name: 'Exercised today', type: 'boolean' },
        { id: 'caffeine', name: 'Consumed caffeine', type: 'boolean' },
        { id: 'water_intake', name: 'Water intake (glasses)', type: 'number' },
        { id: 'mood', name: 'Overall mood (1-10)', type: 'number' },
        { id: 'stress_level', name: 'Stress level (1-10)', type: 'number' }
      ];

      useEffect(() => {
        const saved = localStorage.getItem('wellnessEntries');
        if (saved) setEntries(JSON.parse(saved));
        const savedUrl = localStorage.getItem('googleSheetUrl');
        if (savedUrl) {
          setGoogleSheetUrl(savedUrl);
          setIsConnected(true);
        }
      }, []);

      const getTodayKey = () => new Date().toISOString().split('T')[0];

      const saveEntry = () => {
        const today = getTodayKey();
        const newEntry = { date: today, timestamp: new Date().toISOString(), ...currentEntry };
        const updated = entries.filter(e => e.date !== today);
        updated.push(newEntry);
        setEntries(updated);
        localStorage.setItem('wellnessEntries', JSON.stringify(updated));
        
        if (isConnected && googleSheetUrl) {
          fetch(googleSheetUrl, {
            method: 'POST',
            mode: 'no-cors',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ values: [[today, ...attributes.map(a => currentEntry[a.id] || '')]] })
          }).catch(console.error);
        }
        
        setCurrentEntry({});
        alert('Entry saved!');
      };

      const connectSheet = () => {
        if (googleSheetUrl.trim()) {
          localStorage.setItem('googleSheetUrl', googleSheetUrl);
          setIsConnected(true);
          alert('Connected to Google Sheets!');
        }
      };

      const exportCSV = () => {
        const headers = ['Date', ...attributes.map(a => a.name)];
        const rows = entries.map(e => [e.date, ...attributes.map(a => e[a.id] || '')]);
        const csv = [headers, ...rows].map(r => r.join(',')).join('\n');
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `wellness-${getTodayKey()}.csv`;
        a.click();
      };

      if (showSettings) {
        return h('div', { style: { padding: '20px', maxWidth: '800px', margin: '0 auto', fontFamily: 'sans-serif' }},
          h('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }},
            h('h2', { style: { fontSize: '24px', fontWeight: 'bold' }}, 'Settings'),
            h('button', {
              onClick: () => setShowSettings(false),
              style: { padding: '10px 20px', background: '#3b82f6', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }
            }, 'Done')
          ),
          h('div', { style: { padding: '20px', background: '#f0fdf4', borderRadius: '8px', marginBottom: '20px' }},
            h('h3', { style: { fontSize: '18px', fontWeight: 'bold', marginBottom: '10px' }}, 'Google Sheets Integration'),
            h('input', {
              type: 'text',
              value: googleSheetUrl,
              onChange: e => setGoogleSheetUrl(e.target.value),
              placeholder: 'Paste Google Apps Script URL',
              style: { width: '100%', padding: '10px', border: '2px solid #ccc', borderRadius: '8px', marginBottom: '10px' }
            }),
            h('button', {
              onClick: connectSheet,
              style: { width: '100%', padding: '12px', background: '#22c55e', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }
            }, isConnected ? 'Connected' : 'Connect')
          ),
          h('div', {},
            h('h3', { style: { fontSize: '18px', fontWeight: 'bold', marginBottom: '10px' }}, 'Export Data'),
            h('button', {
              onClick: exportCSV,
              style: { padding: '12px 24px', background: '#22c55e', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }
            }, 'Export CSV')
          )
        );
      }

      if (view === 'history') {
        return h('div', { style: { padding: '20px', maxWidth: '800px', margin: '0 auto', fontFamily: 'sans-serif' }},
          h('div', { style: { display: 'flex', justifyContent: 'space-between', marginBottom: '20px' }},
            h('h2', { style: { fontSize: '24px', fontWeight: 'bold' }}, 'History'),
            h('button', {
              onClick: () => setView('today'),
              style: { padding: '10px 20px', background: '#3b82f6', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }
            }, 'Back')
          ),
          entries.length === 0 
            ? h('p', { style: { textAlign: 'center', color: '#999', padding: '40px' }}, 'No entries yet')
            : h('div', {},
                entries.sort((a,b) => b.date.localeCompare(a.date)).map(entry =>
                  h('div', { key: entry.date, style: { padding: '15px', background: '#f9fafb', borderRadius: '8px', marginBottom: '10px' }},
                    h('div', { style: { fontWeight: 'bold', marginBottom: '10px' }}, entry.date),
                    attributes.map(attr => 
                      entry[attr.id] !== undefined && entry[attr.id] !== null && entry[attr.id] !== '' &&
                      h('div', { key: attr.id, style: { fontSize: '14px', margin: '5px 0' }},
                        attr.name + ': ' + (entry[attr.id] === true ? 'Yes' : entry[attr.id] === false ? 'No' : entry[attr.id])
                      )
                    )
                  )
                )
              )
        );
      }

      return h('div', { style: { padding: '20px', maxWidth: '800px', margin: '0 auto', fontFamily: 'sans-serif' }},
        h('div', { style: { display: 'flex', justifyContent: 'space-between', alignItems: 'center', marginBottom: '20px' }},
          h('h1', { style: { fontSize: '28px', fontWeight: 'bold' }}, 'Daily Wellness Tracker'),
          h('div', { style: { display: 'flex', gap: '10px' }},
            h('button', {
              onClick: () => setView('history'),
              style: { padding: '10px 20px', background: '#8b5cf6', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }
            }, 'History'),
            h('button', {
              onClick: () => setShowSettings(true),
              style: { padding: '10px 20px', background: '#6b7280', color: 'white', border: 'none', borderRadius: '8px', cursor: 'pointer' }
            }, 'Settings')
          )
        ),
        h('div', { style: { padding: '15px', background: '#f0f9ff', borderLeft: '4px solid #3b82f6', marginBottom: '20px', borderRadius: '4px' }},
          h('p', {}, new Date().toLocaleDateString('en-US', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }))
        ),
        attributes.map(attr =>
          h('div', { key: attr.id, style: { padding: '15px', background: 'white', borderRadius: '8px', marginBottom: '15px', boxShadow: '0 1px 3px rgba(0,0,0,0.1)' }},
            h('label', { style: { display: 'block', fontWeight: 'bold', marginBottom: '10px' }}, attr.name),
            attr.type === 'boolean'
              ? h('div', { style: { display: 'flex', gap: '10px' }},
                  h('button', {
                    onClick: () => setCurrentEntry({...currentEntry, [attr.id]: true}),
                    style: {
                      flex: 1,
                      padding: '12px',
                      background: currentEntry[attr.id] === true ? '#22c55e' : '#f3f4f6',
                      color: currentEntry[attr.id] === true ? 'white' : '#6b7280',
                      border: 'none',
                      borderRadius: '8px',
                      cursor: 'pointer',
                      fontWeight: 'bold'
                    }
                  }, 'Yes'),
                  h('button', {
                    onClick: () => setCurrentEntry({...currentEntry, [attr.id]: false}),
                    style: {
                      flex: 1,
                      padding: '12px',
                      background: currentEntry[attr.id] === false ? '#ef4444' : '#f3f4f6',
                      color: currentEntry[attr.id] === false ? 'white' : '#6b7280',
                      border: 'none',
                      borderRadius: '8px',
                      cursor: 'pointer',
                      fontWeight: 'bold'
                    }
                  }, 'No')
                )
              : h('input', {
                  type: 'number',
                  value: currentEntry[attr.id] || '',
                  onChange: e => setCurrentEntry({...currentEntry, [attr.id]: e.target.value}),
                  placeholder: 'Enter value',
                  min: attr.id.includes('quality') || attr.id.includes('mood') || attr.id.includes('stress') ? '1' : '0',
                  max: attr.id.includes('quality') || attr.id.includes('mood') || attr.id.includes('stress') ? '10' : undefined,
                  style: { width: '100%', padding: '12px', border: '2px solid #e5e7eb', borderRadius: '8px', fontSize: '16px' }
                })
          )
        ),
        h('button', {
          onClick: saveEntry,
          style: {
            width: '100%',
            padding: '16px',
            background: 'linear-gradient(to right, #22c55e, #3b82f6)',
            color: 'white',
            border: 'none',
            borderRadius: '8px',
            fontSize: '18px',
            fontWeight: 'bold',
            cursor: 'pointer',
            marginTop: '20px'
          }
        }, 'Save Entry')
      );
    }

    ReactDOM.render(React.createElement(WellnessTracker), document.getElementById('root'));
  </script>
</body>
</html>
