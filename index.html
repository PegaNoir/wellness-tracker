function doPost(e) {
  try {
    var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
    var data = JSON.parse(e.postData.contents);
    
    // Log what we received for debugging
    Logger.log('Received data: ' + JSON.stringify(data));
    
    // Append the row data
    sheet.appendRow(data.values[0]);
    
    return ContentService.createTextOutput(JSON.stringify({
      'result': 'success',
      'row': sheet.getLastRow()
    })).setMimeType(ContentService.MimeType.JSON);
    
  } catch(error) {
    // Log the error for debugging
    Logger.log('Error: ' + error.toString());
    
    return ContentService.createTextOutput(JSON.stringify({
      'result': 'error',
      'error': error.toString()
    })).setMimeType(ContentService.MimeType.JSON);
  }
}

function doGet(e) {
  return ContentService.createTextOutput("Health Context API is running");
}

// Test function to verify the script works
function testDataFormat() {
  var testData = {
    values: [['2025-01-02', 'Yes', 'No', 'Yes', 'No', 'Yes', 'No', 'Yes', 'No', 'Yes', 'No', 'Yes', 'No', 'Yes', 'No', 'Yes']]
  };
  
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  sheet.appendRow(testData.values[0]);
  
  Logger.log('Test row added successfully');
}

// Debug function to check what's in the sheet
function checkSheet() {
  var sheet = SpreadsheetApp.getActiveSpreadsheet().getActiveSheet();
  var lastRow = sheet.getLastRow();
  Logger.log('Sheet has ' + lastRow + ' rows');
  Logger.log('Sheet name: ' + sheet.getName());
}
